(()=>{"use strict";class e{constructor(){this.currentField=null,this.init()}async init(){document.getElementById("fillBtn")?.addEventListener("click",()=>this.fillForm()),document.getElementById("manageBtn")?.addEventListener("click",()=>this.openManageAnswers()),document.getElementById("closeModal")?.addEventListener("click",()=>this.closeModal()),document.getElementById("cancelBtn")?.addEventListener("click",()=>this.closeModal()),document.getElementById("saveAndFillBtn")?.addEventListener("click",()=>this.saveAndFill()),await this.updateStatus(),setInterval(()=>this.updateStatus(),2e3)}async updateStatus(){try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e.id)return void this.showStatus("⚠️","No active tab","warning");const t={action:"getUnrecognizedFields"},n=await chrome.tabs.sendMessage(e.id,t);n&&n.length>0?(this.showStatus("✅",`Ready to fill (${n.length} unrecognized)`,"success"),this.showUnrecognizedFields(n)):(this.showStatus("✅","All fields recognized","success"),this.hideUnrecognizedFields())}catch(e){this.showStatus("⚠️","Not a fillable page","warning"),this.hideUnrecognizedFields()}}showStatus(e,t,n){const s=document.getElementById("status");s&&(s.className=`status ${n}`,s.innerHTML=`\n      <div class="status-icon">${e}</div>\n      <div class="status-text">${t}</div>\n    `)}async fillForm(){try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e.id)return;const t={action:"fillForm"},n=await chrome.tabs.sendMessage(e.id,t);n&&(this.showStatus("✨",`Filled ${n.filled}/${n.total} fields`,"success"),await this.updateStatus())}catch(e){this.showStatus("❌","Error filling form","error"),console.error("Fill error:",e)}}showUnrecognizedFields(e){const t=document.getElementById("unrecognizedSection"),n=document.getElementById("unrecognizedList");t&&n&&(t.style.display="block",n.innerHTML="",e.forEach(e=>{const t=document.createElement("div");t.className="field-item",t.innerHTML=`\n        <div class="field-info">\n          <div class="field-context">${this.truncate(e.context,40)}</div>\n          <div class="field-type">${e.fieldType} ${e.inputType?`(${e.inputType})`:""}</div>\n        </div>\n        <button class="add-btn" data-selector="${e.selector}" data-context="${e.context}">\n          + Add\n        </button>\n      `;const s=t.querySelector(".add-btn");s?.addEventListener("click",()=>{this.openAddAnswerModal(e.selector,e.context)}),n.appendChild(t)}))}hideUnrecognizedFields(){const e=document.getElementById("unrecognizedSection");e&&(e.style.display="none")}openAddAnswerModal(e,t){this.currentField={selector:e,context:t};const n=document.getElementById("addAnswerModal"),s=document.getElementById("fieldContext"),i=document.getElementById("answerKey"),a=document.getElementById("answerValue"),o=document.getElementById("siteSpecific");n&&s&&i&&a&&(s.value=t,i.value=this.generateAnswerKey(t),a.value="",o.checked=!1,n.style.display="flex",a.focus())}closeModal(){const e=document.getElementById("addAnswerModal");e&&(e.style.display="none"),this.currentField=null}async saveAndFill(){const e=document.getElementById("answerKey"),t=document.getElementById("answerValue"),n=document.getElementById("siteSpecific");if(!e||!t||!this.currentField)return;const s=e.value.trim(),i=t.value.trim(),a=n.checked;if(s&&i)try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e.id)return;const t={action:"addAnswer",payload:{key:s,value:i,siteSpecific:a}};await chrome.tabs.sendMessage(e.id,t);const n={action:"fillField",payload:{selector:this.currentField.selector,value:i}};await chrome.tabs.sendMessage(e.id,n),this.closeModal(),await this.updateStatus()}catch(e){console.error("Error saving answer:",e),alert("Error saving answer")}else alert("Please fill in both key and value")}generateAnswerKey(e){return e.toLowerCase().replace(/[^a-z0-9\s]/g,"").split(/\s+/).filter(e=>e.length>0).map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1)).join("")}truncate(e,t){return e.length<=t?e:e.substring(0,t)+"..."}openManageAnswers(){chrome.tabs.create({url:chrome.runtime.getURL("manage.html")})}}console.log("popup.ts: Script loaded, creating PopupController...");try{new e,console.log("popup.ts: PopupController created successfully")}catch(e){console.error("popup.ts: Failed to create PopupController:",e);const t=document.querySelector(".container");t&&(t.innerHTML='\n      <div style="padding: 20px;">\n        <h1 style="color: #f44336;">Error</h1>\n        <p>Failed to initialize popup. Check console for details.</p>\n      </div>\n    ')}})();
//# sourceMappingURL=popup.js.map